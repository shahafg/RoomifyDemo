<div class="room-schedule-container" *ngIf="!loading && !error && roomSchedule">
  <div class="room-schedule-content">
    <div class="room-info-section">
      <div class="room-info-header">
        <i class="icon">üè¢</i>
        <h3>Room Information</h3>
      </div>

      <div class="room-details">
        <div class="detail-row">
          <span class="icon">üë•</span>
          <span>Capacity: {{ roomSchedule.room.capacity }} people</span>
        </div>

        <div class="detail-row">
          <span class="icon">üìç</span>
          <span>Floor {{ roomSchedule.room.floor }}</span>
        </div>
      </div>

      <div class="facilities" *ngIf="roomSchedule.room.facilities">
        <p><strong>Facilities:</strong></p>
        <div class="facility-tags">
          <span *ngFor="let facility of getFacilitiesList(roomSchedule.room.facilities)" class="facility-tag"
            [class.available]="facility.available">
            <span class="facility-icon">{{ getFacilityIcon(facility.key) }}</span>
            {{ getFacilityDisplay(facility.key) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Current Status Section -->
    <div class="current-status-section">
      <div class="status-header">
        <i class="icon">üïê</i>
        <h3>Current Status</h3>
      </div>

      <div class="status-content">
        <div class="availability-status" [class.available]="roomSchedule.currentStatus.available">
          <div class="status-indicator">
            <span class="status-dot" [class.available]="roomSchedule.currentStatus.available"></span>
            <span class="status-text">
              {{ roomSchedule.currentStatus.available ? 'Available Now' : 'Occupied' }}
            </span>
            
          </div>
        </div>

        <div class="upcoming-info">
          <p *ngIf="!roomSchedule.currentStatus.nextBooking && isToday()">
            No upcoming bookings
          </p>
          <p *ngIf="roomSchedule.currentStatus.nextBooking">
            Next: {{ roomSchedule.currentStatus.nextBooking.startTime }} - {{
            roomSchedule.currentStatus.nextBooking.endTime }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Schedule Section -->
  <div class="schedule-section">
    <div class="schedule-header">
      <div class="schedule-title">
        <i class="icon">üïê</i>
        <h3>Room {{ roomSchedule.room.name }} Schedule</h3>
      </div>

      <div class="schedule-controls">
        <div class="view-toggle">
        </div>
      </div>
    </div>

    <!-- Book Room Button -->
    <div class="book-room-section" *ngIf="roomSchedule && roomSchedule.room && !this.isStudent">
      <button class="book-room-btn" (click)="openBookingForm()" [disabled]="loading">
        <span class="btn-icon">üìÖ</span>
        Book This Room
      </button>
    </div>

    <div class="date-selector">
      <div class="date-navigation">
        <h4>{{ formatDate(selectedDate) }}</h4>
        <input type="date" [(ngModel)]="selectedDate" (change)="onDateChange()" [min]="getTodayDate()" class="date-input">
      </div>
      <div class="today-indicator" *ngIf="isToday()">
        Today
      </div>
    </div>

    <!-- Period-Based Time Slots -->
    <div class="time-slots" *ngIf="viewMode === 'day' && periodTimeSlots.length > 0">
      <div *ngFor="let periodSlot of periodTimeSlots" class="time-slot period-slot"
        [class.available]="periodSlot.available" [class.booked]="!periodSlot.available"
        (click)="onPeriodTimeSlotClick(periodSlot)">

        <div class="period-info">
          <div class="period-name">{{ periodSlot.period.getPeriodName() }}</div>
          <div class="period-time">{{ periodSlot.time }} - {{ periodSlot.endTime }}</div>
        </div>

        <div class="slot-status">
          <div class="period-subject">
            <span class="subject-label">{{ periodSlot.period.getSubject() }}</span>
          </div>

          <div class="status-indicator">
            <span class="status-dot" [class.available]="periodSlot.available"></span>
            <span class="status-text">
              {{ periodSlot.available ? 'Available' : (periodSlot.booking?.purpose || 'Booked') }}
            </span>
          </div>

          <div class="booking-details" *ngIf="!periodSlot.available && periodSlot.booking">
            <small>{{ periodSlot.booking.bookedBy }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Fallback: Generic Time Slots (when periods not available) -->
    <div class="time-slots" *ngIf="viewMode === 'day' && periodTimeSlots.length === 0 && roomSchedule?.timeSlots">
      <div *ngFor="let timeSlot of roomSchedule.timeSlots" class="time-slot" [class.available]="timeSlot.available"
        [class.booked]="!timeSlot.available" (click)="onTimeSlotClick(timeSlot)">

        <div class="time-info">
          <span class="time">{{ timeSlot.time }}</span>
        </div>

        <div class="slot-status">
          <div class="status-indicator">
            <span class="status-dot" [class.available]="timeSlot.available"></span>
            <span class="status-text">
              {{ timeSlot.available ? 'Available' : (timeSlot.booking?.purpose || 'Booked') }}
            </span>
          </div>

          <div class="booking-details" *ngIf="!timeSlot.available && timeSlot.booking">
            <small>{{ timeSlot.booking.bookedBy }}</small>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Loading room schedule...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error">
  <div class="error-icon">‚ùå</div>
  <p>{{ error }}</p>
  <button (click)="loadSchedule()" class="retry-btn">Retry</button>
</div>

<!-- No Room Selected -->
<div class="no-room-container" *ngIf="!roomId && !loading">
  <div class="no-room-icon">üè¢</div>
  <p>Please select a room to view its schedule</p>
</div>

<!-- Booking Form Modal -->
<app-booking-form *ngIf="showBookingForm && roomSchedule" [roomId]="roomSchedule.room.id"
  [roomName]="roomSchedule.room.name" [building]="roomSchedule.room.building" [floor]="roomSchedule.room.floor"
  [selectedDate]="selectedDate" [preSelectedTimeSlot]="selectedTimeSlot" (closeForm)="closeBookingForm()"
  (bookingCreated)="onBookingCreated($event)">
</app-booking-form>